# Engine API -- EIP-7732

Engine API changes introduced in EIP-7732.

This specification is based on and extends [Engine API - Prague](./prague.md) specification.

## Table of contents

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [Structures](#structures)
- [Methods](#methods)
  - [engine_getPayloadsByHashV1](#engine_getpayloadsbyhashv1)
    - [Request](#request)
    - [Response](#response)
    - [Specification](#specification)
  - [engine_getPayloadsByRangeV1](#engine_getpayloadsbyrangev1)
    - [Request](#request-1)
    - [Response](#response-1)
    - [Specification](#specification-1)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Structures


## Methods

### engine_getPayloadsByHashV1

This method returns full [`ExecutionPayloadV4`](./prague.md#executionpayloadv4) objects

#### Request

* method: `engine_getPayloadsByHashV1`
* params:
  1. `Array of DATA`, 32 Bytes - Array of `block_hash` field values of the `ExecutionPayload` structure
* timeout: 10s

#### Response

* result: `Array of ExecutionPayloadV4` - Array of [`ExecutionPayloadV4`](./prague.md#executionpayloadv4) objects.
* error: code and message set in case an exception happens while processing the method call.

#### Specification

1. Given array of block hashes client software **MUST** respond with array of `ExecutionPayloadV4` objects with the corresponding hashes respecting the order of block hashes in the input array.

1. Client software **MUST** place responses in the order given in the request, using `null` for any missing blocks. For instance, if the request is `[A.block_hash, B.block_hash, C.block_hash]` and client software has data of payloads `A` and `C`, but doesn't have data of `B`, the response **MUST** be `[A, null, C]`.

1. Client software **MUST** support request sizes of at least 32 block hashes. The call **MUST** return `-38004: Too large request` error if the number of requested payloads is too large.

1. Client software **MAY NOT** respond to requests for finalized blocks by hash.

1. This request maps to [`BeaconBlocksByRoot`](https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#beaconblocksbyroot) in the consensus layer `p2p` specification. Callers must be careful to use the execution block hash, instead of the beacon block root.

1. Callers must consider that syncing execution layer client may not serve any blocks, including those that were supplied by `engine_newPayload` calls.

### engine_getPayloadsByRangeV1

This method returns full [`ExecutionPayloadV4`](./prague.md#executionpayloadv4) objects.

#### Request

* method: `engine_getPayloadsByRangeV1`
* params:
  1. `start`: `QUANTITY`, 64 bits - Starting block number
  1. `count`: `QUANTITY`, 64 bits - Number of blocks to return
* timeout: 10s

#### Response

* result: `Array of ExecutionPayloadV4` - Array of [`ExecutionPayloadV4`](./prague.md#executionpayloadv4) objects.
* error: code and message set in case an exception happens while processing the method call.

#### Specification

1. Given a `start` and a `count`, the client software **MUST** respond with array of `ExecutionPayloadV4` objects with the corresponding execution block number respecting the order of blocks in the canonical chain, as selected by the latest `engine_forkchoiceUpdated` call.

1. Client software **MUST** support `count` values of at least 32 blocks. The call **MUST** return `-38004: Too large request` error if the requested range is too large.

1. Client software **MUST** return `-32602: Invalid params` error if either `start` or `count` value is less than `1`.

1. Client software **MUST** place `null` in the response array for unavailable blocks which numbers are lower than a number of the latest known block. Client software **MUST NOT** return trailing `null` values if the request extends past the current latest known block. Execution Layer client software is expected to download and carry the full block history until EIP-4444 or a similar proposal takes into effect. Consider the following response examples:
    * `[B1, B2, ..., Bn]` -- entire requested range is filled with blocks,
    * `[null, null, B3, ..., Bn]` -- first two blocks are unavailable (either pruned or not yet downloaded),
    * `[null, null, ..., null]` -- requested range is behind the latest known block and all blocks are unavailable,
    * `[B1, B2, B3, B4]` -- `B4` is the latest known block and trailing `null` values are trimmed,
    * `[]` -- entire requested range is beyond the latest known block,
    * `[null, null, B3, B4]` -- first two blocks are unavailable, `B4` is the latest known block.

1. This request maps to [`BeaconBlocksByRange`](https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#beaconblocksbyrange) in the consensus layer `p2p` specification.

1. Callers must be careful to not confuse `start` with a slot number, instead mapping the slot to a block number. Callers must also be careful to request non-finalized blocks by hash in order to avoid race conditions around the current view of the canonical chain.

1. Callers must be careful to verify the hash of the received blocks when requesting non-finalized parts of the chain since the response is prone to being re-orged.

1. Callers must consider that syncing execution layer client may not serve any blocks, including those that were supplied by `engine_newPayload` calls.
